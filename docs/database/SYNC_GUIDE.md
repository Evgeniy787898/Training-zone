# Database Synchronization Guide (Production)

## üéØ –¶–µ–ª—å
–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è production Supabase —Å Prisma schema.
**–ú–µ—Ç–æ–¥**: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –ë–î.

---

## ‚úÖ –®–ê–ì 1: –ó–∞–ø—É—Å–∫ SQL –º–∏–≥—Ä–∞—Ü–∏–∏

### 1.1 –û—Ç–∫—Ä—ã—Ç—å Supabase SQL Editor
1. –ó–∞–π—Ç–∏ –≤ [Supabase Dashboard](https://app.supabase.com)
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç: `buqjktrypviesnucczjr`
### 1.2 –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–¢–û–õ–¨–ö–û STEP 1)
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ **STEP 1** –∏–∑ `backend/prisma/migrations/sync_supabase_production.sql`
2. –í—Å—Ç–∞–≤–∏—Ç—å –≤ SQL Editor –∏ –Ω–∞–∂–∞—Ç—å **RUN**.
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã `_backup_exercise_images` –∏ `_backup_program_covers` —Å–æ–∑–¥–∞–Ω—ã.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ—Ç —à–∞–≥. –î–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## ‚úÖ –®–ê–ì 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –¢–µ—Ä–º–∏–Ω–∞–ª (Bypass Timeout)

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Supabase –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 60 —Å–µ–∫—É–Ω–¥, –∏–∑-–∑–∞ —á–µ–≥–æ —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫) –ø–∞–¥–∞—é—Ç.
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `Prisma CLI` –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

### 2.1 –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ backend
```bash
cd backend
```

### 2.2 –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
```bash
npx prisma db push
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
1. Prisma –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Production –ë–î.
2. –û–±–Ω–∞—Ä—É–∂–∏—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ `image1, image2, image3` –∏ –¥–æ–±–∞–≤–∏—Ç—å `image_url_3`.
3. –°–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: `Do you want to ignore the warning?` -> –ù–∞–∂–º–∏—Ç–µ **y**.
4. –í—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤.

> **–ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?** –ú—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ –±—ç–∫–∞–ø –≤—Å–µ—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ —à–∞–≥–µ 1.

---

## ‚úÖ –®–ê–ì 3: –§–∏–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ (SQL)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `db push`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ **STEP 3** –∏–∑ SQL —Ñ–∞–π–ª–∞ –≤ Supabase Editor:

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ **STEP 3** (–∏–Ω–¥–µ–∫—Å—ã –∏ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã).
2. –í—Å—Ç–∞–≤–∏—Ç—å –≤ SQL Editor -> **RUN**.

### 1.3 –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
1. **–ë—ç–∫–∞–ø –∫–∞—Ä—Ç–∏–Ω–æ–∫**: –°–æ–∑–¥–∞–¥—É—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã `_backup_exercise_images` –∏ `_backup_program_covers`. –í—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Ç—É–¥–∞.
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –£–¥–∞–ª—è—Ç—Å—è —Å—Ç–∞—Ä—ã–µ BLOB –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (—á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å Prisma).
3. **–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã**: –°–æ–∑–¥–∞—Å—Ç—Å—è `assistant_notes`.
4. **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø—Ä–∞–≤—è—Ç—Å—è timestamps –∏ constraints.

> **–í–∞–∂–Ω–æ**: –í–∞—à–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ù–ï —É–¥–∞–ª–µ–Ω—ã, –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—ã `_backup_*`. –í—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ—Å—Ç–∞—Ç—å –∏—Ö –æ—Ç—Ç—É–¥–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.

---

## ‚úÖ –®–ê–ì 2: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç

### 2.1 –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
cd backend

# –û–±–Ω–æ–≤–∏—Ç—å Prisma Client
npx prisma generate
```

### 2.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ Production Supabase
npx prisma migrate diff \
  --from-schema-datamodel prisma/schema.prisma \
  --to-url "$DATABASE_URL" \
  --script

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: No differences found
# (–ò–ª–∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, —á—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ)
```

---

## ‚úÖ –®–ê–ì 3: –ó–∞–ø—É—Å–∫

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
./start-with-ngrok.sh
```

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ Production –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Å—Ö–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
